<div class="max-w-2xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">My Preferences</h1>
    <%= link_to edit_user_preference_path, class: "inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium py-2.5 px-4 rounded-lg transition-colors" do %>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
      Edit
    <% end %>
  </div>

  <%# Match Filters %>
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
      <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
      Match Filters
    </h2>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preferred Gender</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.preferred_gender || "Any" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Age Range</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.min_age || "Any" %> â€“ <%= @user_preference.max_age || "Any" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Max Distance</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.max_distance ? "#{@user_preference.max_distance} km" : "Any" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Relationship Goal</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.relationship_goal&.titleize || "Not set" %></p>
      </div>
    </div>
  </div>

  <%# Lifestyle %>
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
      <svg class="w-5 h-5 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
      Lifestyle
    </h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Budget Level</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.budget_level || "Not set" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Alcohol</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.alcohol&.titleize || "Not set" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Smoking</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.smoking&.titleize || "Not set" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Fitness</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.fitness&.titleize || "Not set" %></p>
      </div>
    </div>
  </div>

  <%# Venue Preferences %>
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
      <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      Venue Preferences
    </h2>
    <div class="flex flex-wrap gap-2">
      <% if @user_preference.venue_types.any? %>
        <% @user_preference.venue_types.each do |type| %>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200">
            <%= type.titleize %>
          </span>
        <% end %>
      <% else %>
        <p class="text-sm text-gray-500 dark:text-gray-400">No venue preferences set</p>
      <% end %>
    </div>
  </div>

  <%# Personality Preferences %>
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
      <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
      Personality Preferences
    </h2>
    <div class="grid grid-cols-2 gap-4">
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preferred Education</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.preferred_education || "Any" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preferred Zodiac</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.preferred_zodiac_sign || "Any" %></p>
      </div>
      <div>
        <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preferred MBTI</p>
        <p class="text-sm text-gray-900 dark:text-gray-100 mt-0.5"><%= @user_preference.preferred_mbti || "Any" %></p>
      </div>
    </div>
  </div>

  <%# Weekly Availability %>
  <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center gap-2">
      <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
      Weekly Availability
    </h2>
    <%
      schedule = @user_preference.schedule
      days = %w[monday tuesday wednesday thursday friday saturday sunday]
      time_slots = (7..22).flat_map { |h| ["#{h.to_s.rjust(2, '0')}:00", "#{h.to_s.rjust(2, '0')}:30"] } + ["23:00"]
      has_any = schedule.any? { |_, slots| slots.is_a?(Array) && slots.any? }
    %>

    <% if @user_preference.timezone.present? %>
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">
        Timezone: <span class="font-medium text-gray-700 dark:text-gray-300"><%= @user_preference.timezone %></span>
      </p>
    <% end %>

    <% if has_any %>
      <div class="overflow-x-auto -mx-2 px-2 pb-2 max-h-[28rem] overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg">
        <table class="w-full border-collapse" style="min-width: 26rem;">
          <thead class="sticky top-0 z-10 bg-white dark:bg-gray-800">
            <tr>
              <th class="w-14 bg-white dark:bg-gray-800"></th>
              <% days.each do |day| %>
                <th class="px-0.5 pb-1.5 pt-2 text-center bg-white dark:bg-gray-800">
                  <span class="text-[0.65rem] font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wider leading-tight"><%= day[0..2].upcase %></span>
                </th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% time_slots.each do |slot| %>
              <% is_hour = slot.end_with?(":00") %>
              <tr class="<%= is_hour ? 'border-t border-gray-200 dark:border-gray-700' : '' %>">
                <td class="pr-1 py-0 text-right align-top bg-white dark:bg-gray-800 sticky left-0 z-[5]">
                  <% if is_hour %>
                    <span class="text-[0.6rem] font-medium text-gray-400 dark:text-gray-500 leading-none whitespace-nowrap"><%= slot %></span>
                  <% end %>
                </td>
                <% days.each do |day| %>
                  <td class="px-0.5 py-0.5">
                    <% is_active = schedule.dig(day)&.include?(slot) %>
                    <div class="h-6 sm:h-7 min-w-[2.25rem] rounded-sm
                      <%= is_active ? 'bg-indigo-500 dark:bg-indigo-500 ring-1 ring-indigo-600/50 dark:ring-indigo-400/50' : 'bg-gray-50 dark:bg-gray-700/50 ring-1 ring-gray-200 dark:ring-gray-600' %>">
                    </div>
                  </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="mt-3 flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400">
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-sm bg-indigo-500 inline-block"></span> Available</span>
        <span class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-sm bg-gray-50 dark:bg-gray-700/50 ring-1 ring-gray-200 dark:ring-gray-600 inline-block"></span> Not set</span>
      </div>
    <% else %>
      <p class="text-sm text-gray-500 dark:text-gray-400">No availability set yet. Edit your preferences to set your weekly schedule.</p>
    <% end %>
  </div>

  <div class="mt-6 text-center">
    <%= link_to "Back to Profile", profile_path, class: "text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300" %>
  </div>
</div>
